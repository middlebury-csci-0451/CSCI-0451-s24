<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.339">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Phil">

<title>Warmup Exercises</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./assets/icons/favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      &lt;b&gt;Machine Learning&lt;/b&gt;&lt;br&gt;CSCI 0451
      </li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./"><b>Machine Learning</b><br>CSCI 0451</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Index of Assignments</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Project</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-perceptron" id="toc-sec-perceptron" class="nav-link active" data-scroll-target="#sec-perceptron">Perceptron</a></li>
  <li><a href="#sec-convexity" id="toc-sec-convexity" class="nav-link" data-scroll-target="#sec-convexity">Convexity</a>
  <ul class="collapse">
  <li><a href="#part-2-second-derivative-test" id="toc-part-2-second-derivative-test" class="nav-link" data-scroll-target="#part-2-second-derivative-test">Part 2: Second Derivative Test</a></li>
  <li><a href="#part-3-plotting-practice" id="toc-part-3-plotting-practice" class="nav-link" data-scroll-target="#part-3-plotting-practice">Part 3: Plotting Practice</a></li>
  <li><a href="#part-4-convexity-in-many-variables" id="toc-part-4-convexity-in-many-variables" class="nav-link" data-scroll-target="#part-4-convexity-in-many-variables">Part 4: Convexity in Many Variables</a></li>
  </ul></li>
  <li><a href="#sec-gradient-descent" id="toc-sec-gradient-descent" class="nav-link" data-scroll-target="#sec-gradient-descent">Gradient Descent</a></li>
  <li><a href="#sec-gradient-descent-2" id="toc-sec-gradient-descent-2" class="nav-link" data-scroll-target="#sec-gradient-descent-2">Gradient Descent (Again)</a></li>
  <li><a href="#sec-overfitting" id="toc-sec-overfitting" class="nav-link" data-scroll-target="#sec-overfitting">Overfitting and the Scientific Method</a></li>
  <li><a href="#sec-erm" id="toc-sec-erm" class="nav-link" data-scroll-target="#sec-erm">The Coin-Flipping Game</a></li>
  <li><a href="#sec-classification-rates-2" id="toc-sec-classification-rates-2" class="nav-link" data-scroll-target="#sec-classification-rates-2">Balancing Classification Rates</a></li>
  <li><a href="#sec-limits-quantitative" id="toc-sec-limits-quantitative" class="nav-link" data-scroll-target="#sec-limits-quantitative">Limits of The Quantitative Approach to Discrimination</a></li>
  <li><a href="#sec-vectorization" id="toc-sec-vectorization" class="nav-link" data-scroll-target="#sec-vectorization">Vectorization Brainstorm</a></li>
  <li><a href="#sec-compression" id="toc-sec-compression" class="nav-link" data-scroll-target="#sec-compression">Image Compression Factor of K-Means</a>
  <ul class="collapse">
  <li><a href="#optional-extra" id="toc-optional-extra" class="nav-link" data-scroll-target="#optional-extra">Optional Extra</a></li>
  </ul></li>
  <li><a href="#sec-intro-tensors" id="toc-sec-intro-tensors" class="nav-link" data-scroll-target="#sec-intro-tensors">Introducing Tensors</a></li>
  <li><a href="#sec-backprop" id="toc-sec-backprop" class="nav-link" data-scroll-target="#sec-backprop">Efficient Differentiation</a>
  <ul class="collapse">
  <li><a href="#what-you-should-do" id="toc-what-you-should-do" class="nav-link" data-scroll-target="#what-you-should-do">What You Should Do</a></li>
  </ul></li>
  <li><a href="#sec-convolutional-kernel" id="toc-sec-convolutional-kernel" class="nav-link" data-scroll-target="#sec-convolutional-kernel">Convolutional Kernels</a></li>
  <li><a href="#sec-project-check-in" id="toc-sec-project-check-in" class="nav-link" data-scroll-target="#sec-project-check-in">Project Check-In</a></li>
  <li><a href="#sec-transfer-learning" id="toc-sec-transfer-learning" class="nav-link" data-scroll-target="#sec-transfer-learning">What Needs To Be Learned?</a></li>
  <li><a href="#sec-word-embedding" id="toc-sec-word-embedding" class="nav-link" data-scroll-target="#sec-word-embedding">Word Embedding</a></li>
  <li><a href="#sec-realistic-text" id="toc-sec-realistic-text" class="nav-link" data-scroll-target="#sec-realistic-text">Realistic Text?</a></li>
  <li><a href="#sec-mind-map" id="toc-sec-mind-map" class="nav-link" data-scroll-target="#sec-mind-map">Mind Map</a>
  <ul class="collapse">
  <li><a href="#flowcharts-in-quarto" id="toc-flowcharts-in-quarto" class="nav-link" data-scroll-target="#flowcharts-in-quarto">Flowcharts in Quarto</a></li>
  </ul></li>
  <li><a href="#sec-classification-rates" id="toc-sec-classification-rates" class="nav-link" data-scroll-target="#sec-classification-rates">Classification Rates</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Warmup Exercises</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Phil </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>

<div class="hidden">
<p><span class="math display">\[
\newcommand{\R}{\mathbb{R}}
\newcommand{\vx}{\mathbf{x}}
\newcommand{\vw}{\mathbf{w}}
\newcommand{\vz}{\mathbf{z}}
\newcommand{\norm}[1]{\lVert #1 \rVert}
\newcommand{\bracket}[1]{\langle #1 \rangle}
\newcommand{\abs}[1]{\lvert #1 \rvert}
\newcommand{\paren}[1]{\left( #1 \right)}
\]</span></p>
</div>
<section id="sec-perceptron" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-perceptron">Perceptron</h2>
<section id="part-1" class="level4">
<h4 class="anchored" data-anchor-id="part-1">Part 1</h4>
<p>Sketch the line in <span class="math inline">\(\R^2\)</span> described by the equation <span id="eq-perceptron-boundary"><span class="math display">\[
\bracket{\vw, \vx}  =  b\;,
\tag{1}\]</span></span></p>
<p>where <span class="math inline">\(\vw = \paren{1, -\frac{1}{2}}^T \in \R^2\)</span> and <span class="math inline">\(b = \frac{1}{2}\)</span>. Here, <span class="math inline">\(\bracket{\vw, \vx} = \sum_{i = 1}^n w_i x_i\)</span> is the inner product (or dot product) between the vectors <span class="math inline">\(\vw\)</span> and <span class="math inline">\(\vw\)</span>.</p>
</section>
<section id="part-2" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="part-2">Part 2</h4>
<div class="page-columns page-full"><p>Write a quick Python function called <code>perceptron_classify(w, b, x)</code>. <code>w</code> and <code>x</code> should both be 1d numpy arrays of the same length, and <code>b</code> should be a scalar. Your function should return <code>0</code> if <span class="math inline">\(\bracket{\vw, \vx} &lt; b\)</span> and <code>1</code> if <span class="math inline">\(\bracket{\vw, \vx} \geq b\)</span>. </p><div class="no-row-height column-margin column-container"><span class="">An excellent solution will use neither a <code>for</code>-loop nor an <code>if</code>-statement.</span></div></div>
<p>Verify that your function works on a few simple examples.</p>
</section>
<section id="part-3" class="level4">
<h4 class="anchored" data-anchor-id="part-3">Part 3</h4>
<p>Consider a line of the general form of <a href="#eq-perceptron-boundary" class="quarto-xref">Equation&nbsp;1</a>. Let’s allow <span class="math inline">\(\vx\)</span> and <span class="math inline">\(\vw\)</span> to both be <span class="math inline">\(n\)</span>-dimensional, so that this equation defines a hyperplane in <span class="math inline">\(\R^n\)</span>. Suppose that we wanted to represent <em>the same hyperplane</em> in <span class="math inline">\(\R^n\)</span> using an equation of the form</p>
<p><span id="eq-perceptron-boundary-2"><span class="math display">\[
\bracket{\tilde{\vw}, \tilde{\vx}} = 0\;.
\tag{2}\]</span></span></p>
<p>for some <span class="math inline">\(\tilde{\vw} \in \R^{n+1}\)</span>. Define <span class="math inline">\(\tilde{\vx} = (\vx, 1)\)</span>. How could you define <span class="math inline">\(\tilde{\vw}\)</span> to make <a href="#eq-perceptron-boundary-2" class="quarto-xref">Equation&nbsp;2</a> equivalent to <a href="#eq-perceptron-boundary" class="quarto-xref">Equation&nbsp;1</a>?</p>
</section>
</section>
<section id="sec-convexity" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-convexity">Convexity</h2>
<p>As you learned in Daumé, informally, a convex function is a function that is “bowl-shaped.” Hardt and Recht give the formal definition, which has the benefit of applying to functions of many variables.</p>
<section id="part-1-1" class="level4">
<h4 class="anchored" data-anchor-id="part-1-1">Part 1</h4>
<p>Consider the 0-1 step function that I’ve plotted below:</p>
<div id="b102a2a8" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>) </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>y_hat <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">101</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> <span class="kw">lambda</span> y_hat, y: <span class="dv">1</span> <span class="op">-</span> <span class="dv">1</span><span class="op">*</span>(y_hat<span class="op">*</span>y <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(xlabel <span class="op">=</span> <span class="vs">r"$\hat</span><span class="sc">{y}</span><span class="vs">$"</span>, </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>       ylabel <span class="op">=</span> <span class="vs">r"$\ell(\hat</span><span class="sc">{y}</span><span class="vs">, y)$"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>ax.plot(y_hat, loss(y_hat, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="warmup-exercises_files/figure-html/cell-3-output-1.png" width="445" height="286"></p>
</div>
</div>
<p>Show pictorially that this function is not convex. No proof needed – just the right drawing.</p>
</section>
<section id="part-2-second-derivative-test" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="part-2-second-derivative-test">Part 2: Second Derivative Test</h3>
<p>Another way to tell whether a function is convex is to check its second derivative. If a function <span class="math inline">\(f:S\rightarrow \R\)</span> has a convex domain <span class="math inline">\(S\subseteq \R\)</span>, if <span class="math inline">\(f\)</span> is everywhere twice-differentiable, and if <span class="math inline">\(\frac{d^2f(z_0)}{dz^2} &gt; 0\)</span> for all <span class="math inline">\(z_0 \in S\)</span>, then <span class="math inline">\(f\)</span> is convex.</p>
<div class="page-columns page-full"><p>Use the second derivative test to check that the following two functions are convex: </p><div class="no-row-height column-margin column-container"><span class="">The base of the logarithm doesn’t really matter, but for this course it is always most convenient to assume logs base <span class="math inline">\(e\)</span>, which you might also have seen written <span class="math inline">\(\ln\)</span>.</span></div></div>
<p><span class="math display">\[
\begin{aligned}
f(z) &amp;= - \log z \\
g(z) &amp;= - \log(1-z)\;.
\end{aligned}
\]</span></p>
</section>
<section id="part-3-plotting-practice" class="level3">
<h3 class="anchored" data-anchor-id="part-3-plotting-practice">Part 3: Plotting Practice</h3>
<p>In a Jupyter notebook, write a simple program to plot each of the functions <span class="math inline">\(f\)</span> and <span class="math inline">\(g\)</span> from Part 2. Some of the Part 1 code is likely to help you.</p>
</section>
<section id="part-4-convexity-in-many-variables" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="part-4-convexity-in-many-variables">Part 4: Convexity in Many Variables</h3>
<p>Recall the Hardt and Recht definition of convexity: a function <span class="math inline">\(f:\R^p \rightarrow \R\)</span> is convex if, for any <span class="math inline">\(\lambda \in [0,1]\)</span> and any points <span class="math inline">\(\vz_1, \vz_2 \in \R^p\)</span>,</p>
<p><span class="math display">\[
f(\lambda \vz_1 + (1-\lambda)\vz_2) \leq \lambda f(\vz_1) + (1-\lambda)f(\vz_2)\;.
\]</span></p>
<div class="page-columns page-full"><p>Using this definition, write a short mathematical proof that the function <span class="math inline">\(f(\vz) = \norm{\vz} = \sqrt{\bracket{\vz, \vz}}\)</span> is convex. You will want to use the <em>triangle inequality</em>, which says that <span class="math inline">\(\norm{\vz_1 + \vz_2} \leq \norm{\vz_1} + \norm{\vz_2}\)</span>. </p><div class="no-row-height column-margin column-container"><span class="">This proof requires just a few lines if you carefully use your definitions!</span></div></div>
</section>
</section>
<section id="sec-gradient-descent" class="level2">
<h2 class="anchored" data-anchor-id="sec-gradient-descent">Gradient Descent</h2>
<p>Consider the quadratic function <span class="math inline">\(g(z) = \frac{1}{2}az^2 + bz + c\)</span>.</p>
<ol type="1">
<li>Prove that <span class="math inline">\(g\)</span> has a critical point at the point <span class="math inline">\(z^* = -\frac{b}{a}\)</span> (<em>hint: solve <span class="math inline">\(g'(z^*) = 0\)</span></em>).</li>
<li>What must be true about the constants <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, and <span class="math inline">\(c\)</span> to ensure that this point is a <em>local minimum</em> of <span class="math inline">\(g\)</span>? (<em>Hint: second derivative test</em>).</li>
<li>Suppose now that we are able to evaluate the function <span class="math inline">\(g\)</span>, as well as its derivative <span class="math inline">\(g'\)</span>, but not able to use algebra to find <span class="math inline">\(z^*\)</span> (this mirrors our situation in most practical problems). Instead, we are going to use the following algorithm to attempt to approximate <span class="math inline">\(z^*\)</span>:
<ul>
<li>Begin with some initial guess <span class="math inline">\(z^{(0)}\)</span>.</li>
<li>In each time-step <span class="math inline">\(t\)</span>, compute <span class="math inline">\(z^{(t+1)} \gets z^{(t)} - \alpha g'(z^{(t)})\)</span>, where <span class="math inline">\(\alpha &gt; 0\)</span> is the <em>learning rate</em>.</li>
<li>In practice we would need to specify a stopping criterion, but for this theoretical problem we don’t need to worry about it.</li>
</ul></li>
<li>Using algebra, prove that for any timestep <span class="math inline">\(t\)</span>, <span class="math display">\[
(z^* - z^{(t+1)})^2 = (a\alpha - 1)^2(z^* - z^{(t)})^2\;.
\]</span></li>
<li>Let’s think of <span class="math inline">\(\abs{z^* - z^{(t)}}\)</span> as the <em>error</em> in our current estimate <span class="math inline">\(z^{(t)}\)</span>. Using the recurrence above, conclude that, for any <span class="math inline">\(t\)</span>, the error <span class="math inline">\(\abs{z^* - z^{(t)}}\)</span> satisfies <span class="math display">\[
\abs{z^* - z^{(t)}} = \abs{a\alpha - 1}^{t}\abs{z^* - z^{(0)}}\;.
\]</span></li>
<li>For <span class="math inline">\(\alpha \in (\alpha_*, \alpha^*)\)</span>, we are guaranteed that the error <span class="math inline">\(\abs{z^* - z^{(t)}}\rightarrow 0\)</span> as <span class="math inline">\(t\rightarrow \infty\)</span>. What are <span class="math inline">\(\alpha_*\)</span> and <span class="math inline">\(\alpha^*\)</span>?<br>
</li>
<li>Suppose that <span class="math inline">\(\alpha\)</span> is within the necessary range. I want to guarantee that <span class="math inline">\(\abs{z^* - z^{(t)}} &lt; \epsilon\)</span> for some small <span class="math inline">\(\epsilon &gt; 0\)</span> (in practice we often call this the <em>tolerance</em>). Conclude that the number of steps necessary to reach this tolerance is no greater than <span class="math display">\[
\bar{t} = \frac{ \log \epsilon - \log \abs{z^* - z^{(0)}}}{\log \abs{a\alpha - 1}}\;.
\]</span></li>
</ol>
<p>Ignoring constants with respect to <span class="math inline">\(\epsilon\)</span>, we say that this algorithm for finding the minimum of <span class="math inline">\(g\)</span> with tolerance <span class="math inline">\(\epsilon\)</span> has a <span class="math inline">\(\log \epsilon\)</span> a convergence rate.</p>
</section>
<section id="sec-gradient-descent-2" class="level2">
<h2 class="anchored" data-anchor-id="sec-gradient-descent-2">Gradient Descent (Again)</h2>
<p>Consider the function <span class="math inline">\(f(w_0, w_1) = \sin(w_0w_1)\)</span>. You can define this function like this:</p>
<div id="d1d666a9" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(w):</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.sin(w[<span class="dv">0</span>]<span class="op">*</span>w[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Mathematically, the gradient of this function is</p>
<p><span class="math display">\[\nabla f(w_0, w_1) = (w_1\cos w_0w_1, w_0 \cos w_0w_1)^T.\]</span></p>
<ol type="1">
<li>Implement a simple loop that uses gradient descent to find a minimum of this function.
<ul>
<li>You’ll have to choose the learning rate <span class="math inline">\(\alpha\)</span>.</li>
<li>The <code>np.cos()</code> function will be useful for programming the gradient.</li>
<li>It’s not the fastest approach, but if you’re not show how to program the gradient you can always first implement it as a list of two floats, and then use <code>np.array(my_list)</code> to convert it into a numpy array.</li>
<li>You’ll also need to pick a random starting guess.</li>
</ul></li>
<li>Find two initial guesses for the parameter vector <span class="math inline">\(\vw\)</span> such that you get two <em>different</em> final minimizers (this is possible because <span class="math inline">\(f\)</span> is not convex).</li>
</ol>
</section>
<section id="sec-overfitting" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-overfitting">Overfitting and the Scientific Method</h2>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class=""><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/82/The_Scientific_Method.svg/520px-The_Scientific_Method.svg.png" class="img-fluid"> Image from <a href="https://en.wikipedia.org/wiki/Scientific_method">Wikipedia</a>.</span></div></div>
<p>In <a href="https://en.wikipedia.org/wiki/Scientific_method">the scientific method</a>, it is often emphasized that we need to formulate a hypothesis <em>before</em> performing an experiment. It’s fine for the hypothesis to be based on <em>previous</em> experiments. However, the scientific method never allows us to perform an experiment, formulate a hypothesis, and then say that the experiment supported the (new) hypothesis.</p>
<p>We can think of scientific theories as systems of thought that help us make predictions about new phenomena. With this in mind, <strong><em>please write a short paragraph explaining the importance of hypothesis-first science using the language of machine learning.</em></strong> In your explanation, please use the following vocabulary:</p>
<ul>
<li>Training data.</li>
<li>Training accuracy.</li>
<li>Validation/testing data.</li>
<li>Validation/testing accuracy.</li>
<li>Overfitting.</li>
</ul>
</section>
<section id="sec-erm" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-erm">The Coin-Flipping Game</h2>
<p>Let’s play a game! Here is the setup:</p>
<p>I have a coin with probability of heads equal to <span class="math inline">\(p \in [0,1]\)</span>. I am going to ask you to pick a number <span class="math inline">\(\hat{p} \in [0,1]\)</span>. Then, I flip my coin.</p>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class="">This game is more fun for me than it is for you.</span></div></div>
<ul>
<li>If my coin comes up heads, you give me <span class="math inline">\(-\log \hat{p}\)</span> dollars.</li>
<li>If my coin comes up tails, you give me <span class="math inline">\(-\log (1-\hat{p})\)</span> dollars.</li>
</ul>
<section id="part-1-2" class="level4">
<h4 class="anchored" data-anchor-id="part-1-2">Part 1</h4>
<p>Compute the <em>expected</em> amount of money you will give me when we play this game in terms of <span class="math inline">\(p\)</span> and <span class="math inline">\(\hat{p}\)</span>. Call this quantity <span class="math inline">\(R(\hat{p}, p)\)</span>. This is the <em>risk</em> of the guess <span class="math inline">\(\hat{p}\)</span>.</p>
</section>
<section id="part-2-1" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="part-2-1">Part 2</h4>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class="">Take the derivative and set it equal to 0! Don’t forget to check that you’ve found a minimum of <span class="math inline">\(R(\hat{p}, p)\)</span> rather than a maximum or an inflection point.</span></div></div>
<p>Suppose I tell you the value of <span class="math inline">\(p\)</span>. Write a mathematical proof to show that your best choice of <span class="math inline">\(\hat{p}\)</span> (the one that loses you the least money) is <span class="math inline">\(\hat{p} = p\)</span>.</p>
</section>
<section id="part-3-1" class="level4">
<h4 class="anchored" data-anchor-id="part-3-1">Part 3</h4>
<p>Now suppose that I <em>don’t</em> tell you the true value of <span class="math inline">\(p\)</span>. Instead, I let you observe <span class="math inline">\(n\)</span> coin flips before asking you to make your guess. Describe:</p>
<ul>
<li>A suggestion for choosing <span class="math inline">\(\hat{p}\)</span> based only on the results of the previous flips.</li>
<li>A way to estimate the risk (expected amount of money lost) based only on the results of the previous flips.</li>
</ul>
<p>Your answer should depend on <span class="math inline">\(\hat{p}\)</span> but not on <span class="math inline">\(p\)</span>!</p>
</section>
</section>
<section id="sec-classification-rates-2" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-classification-rates-2">Balancing Classification Rates</h2>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class="">You can do this first part just by copying and pasting lecture code. It doesn’t matter much how good your model is – just make sure you’re able to get predictions.</span></div></div>
<p>Use the code from <a href="./lecture-notes/classification-in-practice.html">our recent lecture</a> to download the Titanic data set as a Pandas data frame and train a model on the training data. Then download the test data. Compute <code>y_pred</code>, the vector of predictions of your model on the test data.</p>
<p>Then, write a function that verifies eq. (2.6) in Alexandra Chouldechova’s paper “<a href="https://via.hypothes.is/https://arxiv.org/pdf/1703.00056.pdf">Fair Prediction with disparate impact</a>.” Here’s what your function should do:</p>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class="">The positive predictive value is <span class="math inline">\(\mathrm{PPV} = \frac{\mathrm{TP}}{\mathrm{TP} + \mathrm{FP}}\)</span>.</span></div></div>
<ol type="1">
<li>Given vectors <code>y_pred</code> of predictions and <code>y_test</code> of actual labels, compute the False Negative Rate (FNR), False Positive Rate (FPR), prevalence <span class="math inline">\(p\)</span>, and positive predictive value (PPV).</li>
<li>Return as a tuple the lefthand side and righthand side of eq. (2.6) in Chouldechova.</li>
<li>Verify that the two numbers are equal!</li>
</ol>
</section>
<section id="sec-limits-quantitative" class="level2">
<h2 class="anchored" data-anchor-id="sec-limits-quantitative">Limits of The Quantitative Approach to Discrimination</h2>
<p>I’ll give you each a number in Slack. The numbers correspond to the following sections of <span class="citation" data-cites="narayanan2022limits">Narayanan (<a href="#ref-narayanan2022limits" role="doc-biblioref">2022</a>)</span>. These are:</p>
<ol type="1">
<li>The null hypothesis allocates the burden of proof (p.&nbsp;7-8)</li>
<li>Compounding inequality is far below the radar of quantitative methods (p.&nbsp;9-10)</li>
<li>Snapshot datasets hide discrimination (p.&nbsp;10-11)</li>
<li>Explaining away discrimination (p.&nbsp;12-13)</li>
<li>What counts as evidence is a subjective choice (p.&nbsp;5-7)</li>
</ol>
<p>For your assigned section, please write a short paragraph (4-5 simple sentences is fine). You should:</p>
<ul>
<li>Summarize Narayanan’s key points in that section.</li>
<li>In one of the sentences, describe which aspects of the Uber case study (p.&nbsp;13-16) reflect the ideas of the section you described.</li>
</ul>
<p>Bring your paragraph in class and be ready to read it to your group.</p>
</section>
<section id="sec-vectorization" class="level2">
<h2 class="anchored" data-anchor-id="sec-vectorization">Vectorization Brainstorm</h2>
<p>In a <a href="./lecture-notes/vectorization.html">recent lecture</a>, we discussed methods of vectorizing text like the document-term matrix that use the <em>bag of words</em> assumption: the order of the words doesn’t matter!</p>
<p>Take some time and propose an alternative approach to word-based text vectorization. Can you find a scheme that would give different vector representations to the following two sentences?</p>
<blockquote class="blockquote">
<p>“I love rabbits, not cats.” “I love cats, not rabbits.”</p>
</blockquote>
<p>You don’t have to implement your vectorization, but please be prepared to write pseudocode for your group to show in detail how you would perform the vectorization.</p>
</section>
<section id="sec-compression" class="level2">
<h2 class="anchored" data-anchor-id="sec-compression">Image Compression Factor of K-Means</h2>
<p>In <a href="https://jakevdp.github.io/PythonDataScienceHandbook/05.11-k-means.html">today’s reading</a> on K-means clustering from the Python Data Science Handbook, Jake VanderPlas considers the use of K-means to reduce the number of distinct colors in an image (Example 2). I encourage you to run the code for this example while thinking about this warmup!</p>
<p>Give an estimate of the <em>compression factor</em>: the reduction of information achieved when compressing an image using k-means clustering into <span class="math inline">\(k\)</span> color clusters. The compression factor is the number of bits required to store the compressed image, divided by the number of bits required to store the original image. Both of these numbers can be computed asymptotically (i.e.&nbsp;with big-oh reasoning) in order to simplify the analysis.</p>
<p>There are multiple good ways to think about this question, and you’re welcome to choose one that makes sense to you <em>as long as you carefully state your steps and assumptions</em>. Here are a few points that I find helpful:</p>
<section id="bits-in-original-image" class="level4">
<h4 class="anchored" data-anchor-id="bits-in-original-image">Bits in Original Image</h4>
<ol type="1">
<li>An image with <span class="math inline">\(n\)</span> rows and <span class="math inline">\(m\)</span> columns has <span class="math inline">\(nm\)</span> pixels.</li>
<li>Each pixel has one of three RGB color channels (Red, Green, and Blue).</li>
<li>Each color channel can be represented with 8 bits (which encode an integer between 0 and 255, denoting the color intensity in that channel).</li>
</ol>
</section>
<section id="bits-in-compressed-image" class="level4">
<h4 class="anchored" data-anchor-id="bits-in-compressed-image">Bits in Compressed Image</h4>
<ol type="1">
<li>If I compress an image into just <span class="math inline">\(k\)</span> distinct colors, then instead of storing the full RGB value for each pixel, I can just store enough bits to uniquely identify the cluster containing each pixel. How many bits do I need for this?</li>
<li>I also need to store a dictionary (hash map) that associates color <span class="math inline">\(j\)</span> (i.e.&nbsp;the centroid of the <span class="math inline">\(j\)</span>th cluster of colors) to its RGB value.</li>
</ol>
</section>
<section id="optional-extra" class="level3">
<h3 class="anchored" data-anchor-id="optional-extra">Optional Extra</h3>
<p>Try running the code above while varying the number of clusters. Do you think that a 16-color compression looks much better than an 8-color compression. Do you think the difference is good enough to justify approximately twice the storage? What about 32 colors vs.&nbsp;16?</p>
</section>
</section>
<section id="sec-intro-tensors" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-intro-tensors">Introducing Tensors</h2>
<p><strong>First</strong>, install <a href="https://pytorch.org/">PyTorch</a> 2.0 into your <code>ml-0451</code> Anaconda environment.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>The best way to install PyTorch is is probably to run the following at the command line:</p>
<pre><code>conda activate ml-0451
pip3 install torch torchvision torchaudio</code></pre>
</div></div><p><strong>Then</strong>, in a blank Jupyter notebook, copy, paste, and run each of the code blocks in the <a href="https://pytorch.org/tutorials/beginner/basics/tensor_tutorial.html">first section</a> of the PyTorch tutorial.</p>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class="">You may need to do a little bit of exploring around the tutorials in order to come up with answers to these questions.</span></div></div>
<p><strong>Finally</strong>, write down a single-sentence answer to each of the following questions:</p>
<ol type="1">
<li>In what ways is a PyTorch tensor <em>similar</em> to a Numpy array?</li>
<li>In what ways is a PyTorch tensor <em>different</em> from a Numpy array?</li>
<li>What is the primary motivation for the use of a specialized tensor data type, rather than an array, for deep learning?</li>
</ol>
</section>
<section id="sec-backprop" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-backprop">Efficient Differentiation</h2>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class="">This exercise is based on <a href="https://chinmayhegde.github.io/dl-notes/notes/lecture02/#sgd-and-neural-networks">a section of Chinmay Hegde’s notes</a> on stochastic gradient descent and neural networks:</span></div></div>
<p>Consider the following function: <span class="math display">\[
L(w, b) = \frac{1}{2} \left(y - \sigma(wx + b)\right)^2 + \frac{1}{2}\lambda w^2\;,
\]</span></p>
<p>where <span class="math inline">\(\sigma(a) = \frac{1}{1 + e^{-a}}\)</span>.</p>
<p>This is the loss function that would be obtained when using a single feature <span class="math inline">\(x\)</span> to predict <span class="math inline">\(y\)</span>, using the function <span class="math inline">\(\sigma(wx + b)\)</span> the predictor and measuring the quality of this predictor using the square-error loss function. Our aim is to compute the gradient of <span class="math inline">\(L\)</span> with respect to <span class="math inline">\(w\)</span> and <span class="math inline">\(b\)</span>, with a “ridge” regularization term <span class="math inline">\(\frac{1}{2}\lambda w^2\)</span> that encourages the weight <span class="math inline">\(w\)</span> to be small.</p>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class="">I’ve used the property of the sigmoid that <span class="math inline">\(\sigma'(a) = \sigma(a)(1-\sigma(a))\)</span>.</span></div></div>
<p>The gradient of <span class="math inline">\(L\)</span> is <span class="math inline">\(\nabla L (w, b) = \left(\frac{\partial L}{\partial w}, \frac{\partial L}{\partial b}\right)\)</span>, where</p>
<p><span id="eq-explicit-gradient"><span class="math display">\[
\begin{aligned}
\frac{\partial L}{\partial w} &amp;= (\sigma(wx + b) - y)\sigma(wx+b)(1 - \sigma(wx+b))x + \lambda w \\
\frac{\partial L}{\partial b} &amp;= (\sigma(wx + b) - y)\sigma(wx+b)(1 - \sigma(wx+b))\;.
\end{aligned}
\tag{3}\]</span></span></p>
<section id="what-you-should-do" class="level3">
<h3 class="anchored" data-anchor-id="what-you-should-do">What You Should Do</h3>
<p>Assume that each of the following operations cost one computational unit:</p>
<ul>
<li>Multiplying or dividing two scalar numbers.</li>
<li>Adding or subtracting two scalar numbers.</li>
<li>Computing an exponential like <span class="math inline">\(e^a\)</span>.</li>
</ul>
<p>Using this assumption:</p>
<ol type="1">
<li>Determine the number of computational units (i.e.&nbsp;computational cost) of computing the gradient of <span class="math inline">\(L\)</span> exactly as written in <a href="#eq-explicit-gradient" class="quarto-xref">Equation&nbsp;3</a>, under the assumption that you are not allowed to store the values of any intermediate computations.</li>
<li>Now determine the computational cost of computing the gradient of <span class="math inline">\(L\)</span> under the assumption that you are allowed to store intermediate computations. Please describe both the number of computations and the number of floating point numbers that must be stored.</li>
<li>Finally, determine the computational cost in terms of both steps and storage to compute <span class="math inline">\(L\)</span> using the backpropagation algorithm (described for a very similar function in <a href="https://chinmayhegde.github.io/dl-notes/notes/lecture02/#sgd-and-neural-networks">Hegde’s notes</a>).</li>
</ol>
<p>Compare your results from each method.</p>
</section>
</section>
<section id="sec-convolutional-kernel" class="level2">
<h2 class="anchored" data-anchor-id="sec-convolutional-kernel">Convolutional Kernels</h2>
<p>Implement kernel convolution. Your implementation should accept a 2d array <code>X</code> (think of <code>X</code> as representing a greyscale image) and a square convolutional kernel <code>K</code>. Your implementation should operate using pure <code>numpy</code>. You can use any zero-padding strategy, but you do need to explain what your strategy is when presenting.</p>
<p>It’s ok to use a for-loop to loop over pixels.</p>
<p>Here’s an example image you can use:</p>
<div id="cc2106a9" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_image(url):</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(Image.<span class="bu">open</span>(urllib.request.urlopen(url)))</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://i.pinimg.com/originals/0e/d0/23/0ed023847cad0d652d6371c3e53d1482.png"</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> read_image(url)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> to_greyscale(im):</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span> <span class="op">-</span> np.dot(im[...,:<span class="dv">3</span>], [<span class="fl">0.2989</span>, <span class="fl">0.5870</span>, <span class="fl">0.1140</span>])</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> to_greyscale(img)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>plt.imshow(img, cmap <span class="op">=</span> <span class="st">"Greys"</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>plt.gca().axis(<span class="st">"off"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>(-0.5, 639.5, 412.5, -0.5)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="warmup-exercises_files/figure-html/cell-5-output-2.png" width="363" height="241"></p>
</div>
</div>
<p>After implementing your function, you should be able to use it like this, replacing the implementation of <code>scipy.signal</code> with your own implementation. The result should look something like this:</p>
<div id="1b5cfdd5" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.signal <span class="im">import</span> convolve2d</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>kernel <span class="op">=</span> np.array([[<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                   [<span class="op">-</span><span class="dv">1</span>,  <span class="dv">8</span>, <span class="op">-</span><span class="dv">1</span>], </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                   [<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>]])</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>convd <span class="op">=</span> convolve2d(img, kernel)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>plt.imshow(convd, cmap <span class="op">=</span> <span class="st">"Greys"</span>, vmin <span class="op">=</span> <span class="dv">0</span>, vmax <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>plt.gca().axis(<span class="st">"off"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>(-0.5, 641.5, 414.5, -0.5)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="warmup-exercises_files/figure-html/cell-6-output-2.png" width="362" height="241"></p>
</div>
</div>
</section>
<section id="sec-project-check-in" class="level2">
<h2 class="anchored" data-anchor-id="sec-project-check-in">Project Check-In</h2>
<p><em>This is a warmup activity that we will repeat weekly until the end of the semester.</em></p>
<p>Prepare a 2-3 minute “presentation” of your project to your group. Your presentation can be informal and does not need to have any special visual aids. The primary expectation is that you are able to demonstrate <em>some relevant functionality</em> to your peers. If your project involves coding or data analysis, your relevant functionality might be as simple as accessing or preparing the data. You should plan to demonstrate additional functionality each week.</p>
<p>In other words, you should show your group <em>something that works</em>, regardless of how “big” it is.</p>
<p>If you are doing a project that does not involve implementation (such as a research essay), then you are still expected to offer an update. Your contributions could include describing the sources you’ve found or showing your group an outline of the argument that you will make.</p>
<p>It’s appropriate for each member of your project group to give the same presentation during warmup. <strong>Please note that you may not be in the same warmup group as your project partners</strong>. This means that:</p>
<ul>
<li>The code you show needs to run on <em>your</em> laptop or in <em>your</em> compute instance (e.g.&nbsp;Google Colab).</li>
<li><em>You</em> need to be ready to explain what is being shown, even if your project partners did much of the work.</li>
</ul>
</section>
<section id="sec-transfer-learning" class="level2">
<h2 class="anchored" data-anchor-id="sec-transfer-learning">What Needs To Be Learned?</h2>
<p>Suppose that you wanted to teach an individual to recognize English-language <a href="https://consumer.ftc.gov/articles/how-recognize-and-avoid-phishing-scams">phishing emails</a>. Write down a few features (based on the linked website, your own experience, or other sources) that you think would help someone classify an email as “phishing attempt or not” based on the text of the email.</p>
<p>Now, imagine that you are going to sit down with your tutee to teach them how to recognize English-language phishing emails. Where would you start your instruction if…</p>
<ol type="1">
<li>Your tutee was another member of your warmup group.</li>
<li>Your tutee was a fluent English speaker but had never used email.</li>
<li>Your tutee was a regular email user but spoke no English.</li>
<li>Your tutee spoke no English and had never seen a computer.</li>
</ol>
<p>Which of these four scenarios would require the most “learning effort?” Which would require the least?</p>
</section>
<section id="sec-word-embedding" class="level2">
<h2 class="anchored" data-anchor-id="sec-word-embedding">Word Embedding</h2>
<p>Take out a sheet of paper and a pencil. Your goal is to place the following words on the sheet of paper in such a way that their location on the sheet is indicative of their relationships to each other. You can decide exactly how to do this. Should words with similar meanings be in the same part of the page? Should pairs of words with similar <em>relationships</em> have similar distances? Your approach is up to you, but please <strong>write it down</strong> along with your placements. Your words are:</p>
<ul>
<li><em>Woman</em></li>
<li><em>Student</em></li>
<li><em>Nurse</em></li>
<li><em>Doctor</em></li>
<li><em>Man</em></li>
<li><em>Professor</em></li>
<li><em>Model</em></li>
<li><em>Computer</em></li>
<li><em>Machine</em></li>
<li><em>Programmer</em></li>
</ul>
</section>
<section id="sec-realistic-text" class="level2">
<h2 class="anchored" data-anchor-id="sec-realistic-text">Realistic Text?</h2>
<p>In our reading on <a href="http://karpathy.github.io/2015/05/21/rnn-effectiveness/">The Unreasonable Effectiveness of Recurrent Neural Networks</a>, there are a few examples of model output that is <em>realistic</em> but not <em>real</em>. Pick one of the examples, and write down as carefully as you are able what makes the generated text <em>realistic</em>. Then, describe what “tells” would tip off an attentive observer that the text isn’t real (generated intentionally by a human) after all.</p>
<p>The Shakespeare and Wikipedia examples might be the easiest ones to think about, but feel free to look at the <span class="math inline">\(\LaTeX\)</span> or Linux source code examples if you prefer.</p>
</section>
<section id="sec-mind-map" class="level2">
<h2 class="anchored" data-anchor-id="sec-mind-map">Mind Map</h2>
<p>Wow, we’ve covered a lot of ground in this class! Use a graphics program or a pen/paper to make a mind map describing some of our main theoretical and concepts. As a reminder, a mind-map is a graph in which the nodes are concepts and edges join related concepts. Please incorporate the following concepts as nodes:</p>
<ul>
<li><em>Loss function</em></li>
<li><em>Target</em></li>
<li><em>Predictor</em></li>
<li><em>Model</em></li>
<li><em>Regression</em></li>
<li><em>Classification</em></li>
<li><em>Empirical risk minimization</em></li>
<li><em>Gradient descent</em></li>
<li><em>Feature map</em></li>
<li><em>Vectorization</em></li>
<li><em>Overfitting</em></li>
<li><em>Training data</em></li>
<li><em>Validation/testing data</em></li>
<li><em>Perceptron</em></li>
<li><em>Logistic regression</em></li>
<li><em>Neural networks</em></li>
<li><em>Linear regression</em></li>
</ul>
<p>Additionally, please incorporate <strong>at least three other concepts of your own choosing</strong>.</p>
<section id="flowcharts-in-quarto" class="level3">
<h3 class="anchored" data-anchor-id="flowcharts-in-quarto">Flowcharts in Quarto</h3>
<p>Since mind-maps can be a little complicated to organize, you might find it easiest to work with some software. One <strong>optional</strong> possibility is actually included with Quarto: the <a href="https://mermaid.js.org/">Mermaid</a> chart tool can render attractive diagrams that include labeled nodes and directed edges. Using a <a href="https://mermaid.js.org/syntax/flowchart.html">flowchart</a> is probably the way. For example, inserting the following code into a special <code>{mermaid}</code> code block will produce the following diagram:</p>
<pre><code>flowchart TB
    A(First concept) --&gt; B(Second concept)
    B --is part&lt;br&gt; of--&gt; A
    B--&gt;C(Third concept)
    A--&gt;C
    A &amp; B &amp; C --&gt;D(Fourth concept)</code></pre>
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<pre class="mermaid mermaid-js">flowchart TB
    A(First concept) --&gt; B(Second concept)
    B --is part&lt;br&gt; of--&gt; A
    B--&gt;C(Third concept)
    A--&gt;C
    A &amp; B &amp; C --&gt;D(Fourth concept)
</pre>
</div>
</div>
</div>
</div>
<p>For the basics of using Mermaid with Quarto, see the <a href="https://quarto.org/docs/authoring/diagrams.html">Quarto docs</a>. A benefit of this approach is that you don’t have to worry too much about positioning, and you can publish your mind map easily on your blog! On the other hand, this approach doesn’t give you much flexibility and makes it harder to be creative about incorporating complex relationships. <strong>Doing your mind map by hand or in any other software is entirely fine</strong>.</p>
</section>
</section>
<section id="sec-classification-rates" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-classification-rates">Classification Rates</h2>
<section id="part-1-3" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="part-1-3">Part 1</h4>
<div class="page-columns page-full"><p>COVID-19 rapid tests have approximately an 80% sensitivity rate, which means that, in an individual who truly has COVID-19, the probability of a rapid test giving a positive result is roughly 80%.  On the other hand, the probability of a rapid test giving a positive result for an individual who truly does <strong>not</strong> have COVID-19 is 5%. Suppose that approximately 4% of the population are currently infected with COVID-19. </p><div class="no-row-height column-margin column-container"><span class="">These numbers are mostly made-up.</span><span class="">Example 2.3.1 of <a href="https://github.com/probml/pml-book/releases/latest/download/book1.pdf">Murphy</a>, page 46, has a good review of the relevant probability and the definition of each of the rates below.</span></div></div>
<p>Write a Python function called <code>rate_summary</code> that prints the following output, filling in the correct values for each of the specified rates:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> <span class="fl">0.8</span>           <span class="co"># test sensitivity</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> <span class="fl">0.02</span>          <span class="co"># probability of positive test if no COVID</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>prevalence <span class="op">=</span> <span class="fl">0.05</span> <span class="co"># fraction of population infected</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>rate_summary(s, f, current_infection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>The true positive rate is ___.
The false positive rate is ___.
The true negative rate is ___. 
The false positive rate is ___. </code></pre>
</section>
<section id="part-2-2" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="part-2-2">Part 2</h4>
<ol type="1">
<li>Suppose that scientists found an alternative rapid test which had a 75% sensitivity rate with a 0% chance of a positive test on someone who is truly not infected. Would you suggest replacing the old rapid tests with these alternative tests? Why? </li>
<li>What if the alternative test had an 85% sensitivity rate and a 10% chance of a positive test on someone who is truly not infected?</li>
</ol>
<div class="no-row-height column-margin column-container"><span class="">You don’t necessarily need to use your function from the previous part in this part.</span></div></section>
<section id="part-3-2" class="level4">
<h4 class="anchored" data-anchor-id="part-3-2">Part 3</h4>
<p>It’s all well and good to do the math, but what about when we actually have data? Write a function called <code>rate_summary_2</code> that accepts two columns of a <code>pandas.DataFrame</code> (or equivalently two one-dimensional <code>numpy.arrays</code> of equal length). Call these <code>y</code> and <code>y_pred</code>. Assume that both <code>y</code> and <code>y_pred</code> are binary arrays (i.e.&nbsp;arrays of 0s and 1s). <code>y</code> represents the true outcome, whereas <code>y_pred</code> represents the prediction from an algorithm or test. Here’s an example of the kind of data we are thinking about:</p>
<div id="97431b72" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://github.com/middlebury-csci-0451/CSCI-0451/raw/main/data/toy-classification-data.csv"</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(url)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>df.head() <span class="co"># just for visualizing the first few rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">y_pred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>You should be able to use your function like this:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># y is the true label, y_pred is the prediction</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>rate_summary_2(df[<span class="st">"y"</span>], df[<span class="st">"y_pred"</span>]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>The true positive rate is ___.
The false positive rate is ___.
The true negative rate is ___. 
The false positive rate is ___. </code></pre>
<section id="hints" class="level5">
<h5 class="anchored" data-anchor-id="hints">Hints</h5>
<p>An excellent solution for this part will not use any for-loops. Computing each of the four rates can be performed in a single compact line of code. To begin thinking of how you might do this, you may want to experiment with code like the following:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">"y"</span>]] <span class="op">==</span> df[[<span class="st">"y_pred"</span>]]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">"y"</span>]].<span class="bu">sum</span>(), df[[<span class="st">"y"</span>]].<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>



</section>
</section>
</section>

<p><br> <br> <span style="color:grey;">© Phil Chodrow, 2023</span></p><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-narayanan2022limits" class="csl-entry" role="listitem">
Narayanan, Arvind. 2022. <span>“The Limits of the Quantitative Approach to Discrimination.”</span> Speech.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>